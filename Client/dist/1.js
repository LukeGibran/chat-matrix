(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{692:function(e,t){},693:function(e,t){},694:function(e,t){},695:function(e,t){},696:function(e,t){},702:function(e,t){},703:function(e,t){},704:function(e,t){},705:function(e,t){},706:function(e,t){},707:function(e,t){},727:function(e,t,n){"use strict";var o=null,r={setIO:function(e){o=e},update:function(e){null!==o&&o.emit("UPDATE_BUSY_STATUS",e)}};t.a=r},728:function(e,t,n){"use strict";var o=n(1),r=n.n(o),i=n(6),a=n.n(i),l=n(311),c=n(715),s=n(727);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=m(e);if(t){var r=m(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return h(this,n)}}function h(e,t){return!t||"object"!==u(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var y={position:"fixed",top:0,left:0,bottom:0,right:0,backgroundColor:"#000",opacity:.5,zIndex:1040},v={position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:1040},b={backgroundColor:"#C5C8C8",borderColor:"#C5C8C8"},g=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(u,e);var t,n,i,a=p(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=a.call(this,e)).modalDialog=r.a.createRef(),t._modalStyle={position:"absolute",margin:0,top:0,left:0,opacity:0},t}return t=u,(n=[{key:"componentDidMount",value:function(){s.a.update(!0),this.calculateModalPosition()}},{key:"componentWillUnmount",value:function(){s.a.update(!1)}},{key:"calculateModalPosition",value:function(){var e=this.modalDialog.current;if(e){var t=e.offsetHeight>window.innerHeight?0:(window.innerHeight-e.offsetHeight)/2;this._modalStyle={position:"absolute",margin:"auto",top:t,left:0,bottom:0,right:0,opacity:1},this.forceUpdate()}}},{key:"render",value:function(){var e=this.props,t=e.message,n=e.resolveLabel,i=e.rejectLabel,a=e.onResolve,s=e.onReject;return r.a.createElement(o.Fragment,null,r.a.createElement("div",{style:y}),r.a.createElement("div",{style:v},r.a.createElement(l.a.Dialog,{size:"sm",ref:this.modalDialog,className:"px-1",style:this._modalStyle},r.a.createElement(l.a.Body,{className:"text-center text-dark"},r.a.createElement("p",{className:"lead mt-3"},t)),r.a.createElement(l.a.Footer,null,void 0!==a&&r.a.createElement(c.a,{size:"lg",variant:"primary",className:"ml-auto w-100",onClick:a},n||"Yes"),void 0!==s&&r.a.createElement(c.a,{style:b,size:"lg",variant:"dark",className:"mr-auto w-100",onClick:s},i||"No")))))}}])&&f(t.prototype,n),i&&f(t,i),u}(o.Component);g.propTypes={message:a.a.string,resolveLabel:a.a.string,rejectLabel:a.a.string,onResolve:a.a.func,onReject:a.a.func},t.a=g},729:function(e,t,n){e.exports=n.p+"07d7d8a13b2ab192b2d6c32cfda8bc51.jpg"},730:function(e,t,n){"use strict";var o=n(689),r=n.n(o),i=n(141),a={upload:function(e,t){return new Promise((function(n,o){if(!e)return o("Invalid avatar argument supplied");var a=function(e){var t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var n=e.split(",")[0].split(":")[1].split(";")[0],o=new Uint8Array(t.length),r=0;r<t.length;r++)o[r]=t.charCodeAt(r);return new Blob([o],{type:n})}(e),l=new FormData;l.append("profile",a,t),r.a.post("".concat(i.a.serverURL,"/c/chat/profile"),l).then((function(e){"success"===e.data?n():o("Error uploading avatar: ".concat(e.data))})).catch((function(e){return o(e)}))}))}};t.a=a},731:function(e,t,n){"use strict";var o=null,r={onTimeout:null,reset:function(){var e=this;o&&(clearTimeout(o),o=null),o=setTimeout((function(){e.onTimeout&&e.onTimeout(),e.stop()}),18e4),window.addEventListener("click",i),window.addEventListener("touchstart",a)},stop:function(){o&&(clearTimeout(o),o=null),window.removeEventListener("click",i),window.removeEventListener("touchstart",a)}};function i(){r.reset()}function a(){r.reset()}t.a=r},732:function(e,t,n){"use strict";var o=n(1),r=n.n(o),i=n(6),a=n.n(i),l=n(141),c=n(206);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=h(e);if(t){var r=h(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return p(this,n)}}function p(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(a,e);var t,n,o,i=d(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).state={isShowMessage:!1},t._messageTimeout=null,t}return t=a,(n=[{key:"componentDidMount",value:function(){var e=this,t=(l.a.isMobile,1e3);this._messageTimeout=setTimeout((function(){e.setState({isShowMessage:!0})}),t),navigator.mediaDevices.getUserMedia(l.a.userMediaConstraints).then((function(t){clearTimeout(e._messageTimeout),e.props.onGetUserMedia(t,null)})).catch((function(t){e.props.onGetUserMedia(null,t),setTimeout((function(){window.location.href="/"}),2e4)})).finally((function(){return e.setState({isShowMessage:!1})}))}},{key:"componentWillUnmount",value:function(){clearTimeout(this._messageTimeout),this._messageTimeout=null}},{key:"render",value:function(){return this.state.isShowMessage?r.a.createElement(c.a,{message:"Please allow Camera and Microphone access and please use headphones to prevent echoing."}):null}}])&&u(t.prototype,n),o&&u(t,o),a}(o.Component);m.propTypes={onGetUserMedia:a.a.func},t.a=m},733:function(e,t,n){e.exports=n.p+"29c7a4146952cc58029731cd657203cc.png"},734:function(e,t,n){"use strict";(function(e){var o=n(1),r=n.n(o),i=n(6),a=n.n(i),l=n(698),c=n(738),s=n(739),u=n(206),f=n(728),d=n(740),p=n(727),h=n(735),m=n.n(h),y=n(742),v=n.n(y),b=n(743),g=n.n(b);function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function R(e,t){return(R=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=T(e);if(t){var r=T(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return C(this,n)}}function C(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?_(e):t}function _(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e){return(T=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var P=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&R(e,t)}(y,t);var n,i,a,h=S(y);function y(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),O(_(t=h.call(this,e)),"handleCallCancel",(function(){t.props.io.emit("CANCEL_REQUEST"),t.setState({callee:null})})),O(_(t),"handleCallAccept",(function(){t.ringtone.stop(),t.props.onAccept()})),O(_(t),"handleCallDeny",(function(){t.ringtone.stop(),t.props.io.emit("DENY_REQUEST"),t.setState({caller:null})})),O(_(t),"callDenied",(function(){p.a.update(!0),t.setState({callee:null,remoteStream:null,reportModalMessage:null,paidCallEndModalMessage:null,callEndModalMessage:"Not available",isStarted:!1}),setTimeout((function(){t.setState({callEndModalMessage:null}),p.a.update(!1)}),2e3)})),O(_(t),"handleCallExit",(function(){t.handleGenericModalResolve()})),O(_(t),"handleCallReport",(function(){t.setState({reportModalMessage:"Report this user for bad behavior?"})})),O(_(t),"handleGenericModalResolve",(function(){var e=t.state,n=e.caller,o=e.callee,r=e.reportModalMessage,i=t.props.io,a=n||o;t.closePeerConnection(),t.setState({caller:null,callee:null,remoteStream:null,reportModalMessage:null,callEndModalMessage:null,paidCallEndModalMessage:null,isStarted:!1}),p.a.update(!1),t.props.onExit(),i.emit("LEAVE_ROOM"),null!==r&&i.emit("REPORT_USER",a)})),O(_(t),"handleGenericModalReject",(function(){t.setState({reportModalMessage:null})})),O(_(t),"handleLocalVideoReady",(function(){t.props.io.emit("USER_MEDIA_INITIALIZED")})),O(_(t),"handleRemoteVideoReady",(function(){t.isPaidCall&&t.props.io.emit("VIP_REMOTE_STREAM_RECEIVED")})),t.state={caller:null,callee:null,remoteStream:null,reportModalMessage:null,callEndModalMessage:null,paidCallEndModalMessage:null,isStarted:!1},t.isEventsAdded=!1,t.isPaidCall=!1,t.peer=null,t.ringtone=new l.Howl({src:[m.a]}),t.isTabActive=!1,t.blinkIntervalId=null,t}return n=y,(i=[{key:"componentDidMount",value:function(){var e=this;window.onfocus=function(){e.isTabActive=!0,e.hideCallNotification()},window.onblur=function(){e.isTabActive=!1},window.onclick=function(){window.onclick=null,e.isTabActive=!0,e.hideCallNotification()}}},{key:"componentDidUpdate",value:function(){var e=this;if(!this.isEventsAdded){var t=this.props,n=t.io,o=t.onStart,r=t.onVIPEnd;n&&(this.isEventsAdded=!0,n.on("REQUEST_SENT",(function(t){return e.setState({callee:t})})),n.on("REQUEST_DENIED",(function(){return e.callDenied()})),n.on("REQUEST_RECEIVED",(function(t){e.ringtone.play(),e.showCallNotification(),e.setState({caller:t})})),n.on("REQUEST_CANCELLED",(function(){e.ringtone.stop(),e.hideCallNotification(),e.setState({caller:null})})),n.on("REQUEST_DISCONNECTED",(function(){null!==e.state.caller&&(e.ringtone.stop(),e.hideCallNotification()),e.setState({caller:null,callee:null})})),n.on("INITIALIZE_CHAT",(function(t,n){e.isPaidCall=null!==t&&null!==n,e.isPaidCall&&e.setState({caller:t,callee:n}),e.setState({isStarted:!0}),p.a.update(!0),o()})),n.on("INITIALIZE_PEER_CONNECTION",(function(){return e.openPeerConnection()})),n.on("SIGNAL",(function(t){if(e.peer)switch(t.type){case"offer":var o=new RTCSessionDescription(t);e.peer.setRemoteDescription(o).then((function(){return e.peer.createAnswer()})).then((function(t){return e.peer.setLocalDescription(t)})).then((function(){return n.emit("SIGNAL",e.peer.localDescription)})).catch((function(e){return console.error(e)}));break;case"answer":var r=new RTCSessionDescription(t);e.peer.setRemoteDescription(r).catch((function(e){return console.log(e)}));break;default:var i=new RTCIceCandidate(t);e.peer.addIceCandidate(i).catch((function(e){return console.log(e)}))}})),n.on("USER_LEFT_ROOM",(function(){return e.endCall()})),n.on("USER_ROOM_DISCONNECTED",(function(t){return e.endCall(t)})),n.on("VIP_CHAT_INITIALIZED",(function(){n.emit("CREATE_VIP_CHAT_ROOM")})),n.on("VIP_CHAT_ENDED",(function(t){e.closePeerConnection(),e.setState({caller:null,callee:null,remoteStream:null,isStarted:!1}),r(t)})),n.on("START_NEXT_VIP_CHAT",(function(){e.setState({isStarted:!1}),n.emit("INITIALIZE_VIP_CHAT")})))}}},{key:"componentWillUnmount",value:function(){var e=this.state.io;this.isEventsAdded=!1,this.isPaidCall=!1,window.onfocus=null,window.onblur=null,window.onclick=null,e&&(e.off("REQUEST_SENT"),e.off("REQUEST_DENIED"),e.off("REQUEST_DISCONNECTED"),e.off("REQUEST_RECEIVED"),e.off("REQUEST_CANCELLED"),e.off("INITIALIZE_CHAT"),e.off("INITIALIZE_PEER_CONNECTION"),e.off("SIGNAL"),e.off("USER_LEFT_ROOM"),e.off("USER_ROOM_DISCONNECTED"),e.off("VIP_CHAT_INITIALIZED"),e.off("VIP_CHAT_ENDED"),e.off("START_NEXT_VIP_CHAT")),this.ringtone.stop(),this.hideCallNotification(),null!==this.peer&&this.closePeerConnection()}},{key:"openPeerConnection",value:function(){var t=this;if(!this.peer){console.log("open peer connection");var n=this.props,o=n.userID,r=n.io,i=n.localStream,a=this.state,l=a.callee,c=a.caller,s=!1;s=this.isPaidCall?c.userId===o:null!==l,this.peer=new RTCPeerConnection({iceServers:[{urls:"turn:"+e.env.SERVER,username:"randy",credential:"reyes"}]}),this.peer.onicecandidate=function(e){e.candidate&&r.emit("SIGNAL",e.candidate)},this.peer.onremovestream=function(){return t.closePeerConnection()},this.peer.oniceconnectionstatechange=function(){switch(t.peer.iceConnectionState){case"closed":case"failed":case"disconnected":t.closePeerConnection()}},this.peer.onicegatheringstatechange=function(){"complete"===t.peer.iceGatheringState&&console.log("peer connection success")},this.peer.onsignalingstatechange=function(){"closed"===t.peer.signalingState&&t.closePeerConnection()},this.peer.onnegotiationneeded=function(){t.peer.onnegotiationneeded=null,s&&(console.log("create offer"),t.peer.createOffer().then((function(e){return t.peer.setLocalDescription(e)})).then((function(){return r.emit("SIGNAL",t.peer.localDescription)})).catch((function(e){return console.log(e)})))},void 0!==this.peer.addTrack?(i.getTracks().forEach((function(e){return t.peer.addTrack(e,i)})),this.peer.ontrack=function(e){return t.setState({remoteStream:e.streams[0]})}):(this.peer.addStream(i),this.peer.onaddstream=function(e){return t.setState({remoteStream:e.stream})})}}},{key:"closePeerConnection",value:function(){this.peer&&(console.log("close peer connection"),this.peer.onaddstream=null,this.peer.ontrack=null,this.peer.onremovestream=null,this.peer.onnicecandidate=null,this.peer.oniceconnectionstatechange=null,this.peer.onsignalingstatechange=null,this.peer.onicegatheringstatechange=null,this.peer.onnotificationneeded=null,this.peer.close(),this.peer=null)}},{key:"endCall",value:function(e){var t=this;this.setState({caller:null,callee:null,remoteStream:null,reportModalMessage:null,paidCallEndModalMessage:null,callEndModalMessage:"Your partner has gone",isStarted:!1}),p.a.update(!0),setTimeout((function(){t.setState({callEndModalMessage:null}),p.a.update(!1)}),2e3),this.closePeerConnection(),this.props.onExit()}},{key:"showCallNotification",value:function(){if(!this.isTabActive){var e=document.getElementById("favicon"),t=0,n="NEW VIDEO CALL REQUEST";this.blinkIntervalId=setInterval(o,1e3),o()}function o(){e.href=0===t?g.a:v.a,document.title=0===t?n.toUpperCase():n.toLowerCase(),t++,t%=2}}},{key:"hideCallNotification",value:function(){null!==this.blinkIntervalId&&(clearInterval(this.blinkIntervalId),this.blinkIntervalId=null),document.getElementById("favicon").href=v.a,document.title="The Chat Matrix: 1-to-1 video calls"}},{key:"render",value:function(){var e=this.state,t=e.caller,n=e.callee,i=e.remoteStream,a=e.isStarted,l=e.reportModalMessage,p=e.callEndModalMessage,h=e.paidCallEndModalMessage,m=this.props,y=m.isUserVIP,v=m.userIP,b=m.localStream,g=m.windowWidth,w=m.windowHeight,E=!1,R=null,S=null;null!==t&&(t.isVip?R=t:S=t,E=t.IP!==v),null!==n&&(n.isVip?R=n:S=n,E=n.IP!==v);var C=p||h,_=l,T=!y&&null!==n&&!1===a,O=!y&&null!==t&&!1===a,P=null!==p||null!==h,k=null!==l;return r.a.createElement(o.Fragment,null,T&&r.a.createElement(c.a,{callee:n,onCancel:this.handleCallCancel}),O&&r.a.createElement(s.a,{caller:t,onDeny:this.handleCallDeny,onAccept:this.handleCallAccept}),P&&!y&&r.a.createElement(u.a,{message:C}),k&&r.a.createElement(f.a,{message:_,onResolve:this.handleGenericModalResolve,onReject:this.handleGenericModalReject}),a&&r.a.createElement(d.a,{isUserVIP:y,isStarted:a,windowWidth:g,windowHeight:w,localStream:b,remoteStream:i,vip:R,customer:S,isCanReport:E,isPaidCall:this.isPaidCall,onExit:this.handleCallExit,onReport:this.handleCallReport,onLocalVideoReady:this.handleLocalVideoReady,onRemoteVideoReady:this.handleRemoteVideoReady}))}}])&&E(n.prototype,i),a&&E(n,a),y}(o.Component);P.propTypes={userID:a.a.string,userIP:a.a.string,isUserVIP:a.a.bool,io:a.a.object,localStream:a.a.object,windowWidth:a.a.number,windowHeight:a.a.number,onStart:a.a.func,onVIPEnd:a.a.func,onAccept:a.a.func,onExit:a.a.func},t.a=P}).call(this,n(25))},735:function(e,t,n){e.exports=n.p+"fb3a373c9ccdefa1138c643d9b49c5a4.mp3"},736:function(e,t,n){"use strict";var o=n(1),r=n.n(o),i=n(6),a=n.n(i),l=n(141);function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function f(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=p(e);if(t){var r=p(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return d(this,n)}}function d(e,t){return!t||"object"!==c(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h={position:"relative",overflow:"hidden",width:"11.5em",height:"11.5em"},m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(a,e);var t,n,o,i=f(a);function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=i.call(this,e)).state={videoWidth:240,videoHeight:180,rootWidth:180,rootHeight:180},t.root=r.a.createRef(),t.video=r.a.createRef(),t.isVideoReady=!1,t}return t=a,(n=[{key:"componentDidMount",value:function(){var e=this,t=this.props.stream,n=this.video.current,o=this.root.current;!0!==this.isVideoReady&&null!==t&&null!==n&&null!==o&&(n.srcObject=t,l.a.isVideoReady(n).then((function(){e.isVideoReady=!0,e.setState({videoWidth:n.videoWidth,videoHeight:n.videoHeight,rootWidth:o.offsetWidth,rootHeight:o.offsetHeight})})))}},{key:"componentWillUnmount",value:function(){this.isVideoReady=!1}},{key:"render",value:function(){var e=this.state,t=e.videoWidth,n=e.videoHeight,o=e.rootWidth,i=e.rootHeight,a=t>n?Math.ceil(o/56.25*100)/t:o/t,l={position:"absolute",width:t,height:n,top:(i-n*a)/2,left:(o-t*a)/2,transformOrigin:"0 0",transform:"scale(".concat(a,")")};return r.a.createElement("div",{ref:this.root,style:h,className:"mx-auto"},r.a.createElement("video",{ref:this.video,autoPlay:!0,playsInline:!0,className:"bg-secondary",style:l},"Your browser does not support the video tag"))}}])&&s(t.prototype,n),o&&s(t,o),a}(o.Component);m.propTypes={stream:a.a.object},t.a=m},737:function(e,t,n){"use strict";var o=n(6),r=n.n(o),i=n(697),a=n.n(i),l=n(1),c=n.n(l),s=n(61),u={unpack_cascade:function(e){var t=new DataView(new ArrayBuffer(4)),n=8;t.setUint8(0,e[n+0]),t.setUint8(1,e[n+1]),t.setUint8(2,e[n+2]),t.setUint8(3,e[n+3]);var o=t.getInt32(0,!0);n+=4,t.setUint8(0,e[n+0]),t.setUint8(1,e[n+1]),t.setUint8(2,e[n+2]),t.setUint8(3,e[n+3]);var r=t.getInt32(0,!0);n+=4;for(var i=[],a=[],l=[],c=0;c<r;++c){var s;for(Reflect.apply(Array.prototype.push,i,[0,0,0,0]),Reflect.apply(Array.prototype.push,i,e.slice(n,n+4*Math.pow(2,o)-4)),n=n+4*Math.pow(2,o)-4,s=0;s<Math.pow(2,o);++s)t.setUint8(0,e[n+0]),t.setUint8(1,e[n+1]),t.setUint8(2,e[n+2]),t.setUint8(3,e[n+3]),a.push(t.getFloat32(0,!0)),n+=4;t.setUint8(0,e[n+0]),t.setUint8(1,e[n+1]),t.setUint8(2,e[n+2]),t.setUint8(3,e[n+3]),l.push(t.getFloat32(0,!0)),n+=4}return i=new Int8Array(i),a=new Float32Array(a),l=new Float32Array(l),function(e,t,n,c,s){e*=256,t*=256;for(var u=0,f=0,d=Math.pow(2,o)>>0,p=0;p<r;++p){for(var h=1,m=0;m<o;++m)h=2*h+(c[(e+i[u+4*h+0]*n>>8)*s+(t+i[u+4*h+1]*n>>8)]<=c[(e+i[u+4*h+2]*n>>8)*s+(t+i[u+4*h+3]*n>>8)]);if((f+=a[d*p+h-d])<=l[p])return-1;u+=4*d}return f-l[r-1]}},run_cascade:function(e,t,n){for(var o=e.pixels,r=e.nrows,i=e.ncols,a=e.ldim,l=n.shiftfactor,c=n.minsize,s=n.maxsize,u=n.scalefactor,f=c,d=[];f<=s;){for(var p=Math.max(l*f,1)>>0,h=f/2+1>>0,m=h;m<=r-h;m+=p)for(var y=h;y<=i-h;y+=p){var v=t(m,y,f,o,a);v>0&&d.push([m,y,f,v])}f*=u}return d},cluster_detections:function(e,t){e=e.sort((function(e,t){return t[3]-e[3]}));for(var n,o,r,i,a,l,c,s,u,f,d=new Array(e.length).fill(0),p=[],h=0;h<e.length;++h)if(0===d[h]){for(var m=0,y=0,v=0,b=0,g=0,w=h;w<e.length;++w)n=e[h],o=e[w],r=void 0,i=void 0,a=void 0,l=void 0,c=void 0,s=void 0,u=void 0,f=void 0,r=n[0],i=n[1],a=n[2],l=o[0],c=o[1],s=o[2],u=Math.max(0,Math.min(r+a/2,l+s/2)-Math.max(r-a/2,l-s/2)),f=Math.max(0,Math.min(i+a/2,c+s/2)-Math.max(i-a/2,c-s/2)),u*f/(a*a+s*s-u*f)>t&&(d[w]=1,m+=e[w][0],y+=e[w][1],v+=e[w][2],b+=e[w][3],g+=1);p.push([m/g,y/g,v/g,b])}return p},instantiate_detection_memory:function(e){for(var t=0,n=[],o=0;o<e;++o)n.push([]);return function(e){n[t]=e,t=(t+1)%n.length,e=[];for(var o=0;o<n.length;++o)e=e.concat(n[o]);return e}}},f=u,d=n(311),p=n(715),h=n(141);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=w(e);if(t){var r=w(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return g(this,n)}}function g(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var E={paddingTop:"75%"},R={top:0},S={whiteSpace:"pre-line",top:0,backgroundColor:"rgba(0, 0, 0, 0.75)"},C={backgroundColor:"#C5C8C8",borderColor:"#C5C8C8"},_={position:"fixed",top:0,left:0,bottom:0,right:0,backgroundColor:"#000",opacity:.5,zIndex:1040},T={position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:1040},O=c.a.forwardRef((function(e,t){return c.a.createElement("canvas",{ref:t,width:480,height:360,style:R,className:"position-absolute w-100 h-100"})})),P=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(i,e);var t,n,o,r=b(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(t=r.call(this,e)).modalDialog=c.a.createRef(),t._modalStyle={position:"absolute",margin:0,top:0,left:0,opacity:0},t._timeout=null,t}return t=i,(n=[{key:"componentDidMount",value:function(){var e=this,t=this.props.isVIP;this.calculateModalPosition(),this._timeout=setTimeout((function(){e._timeout=null,t?(window.open("https://instagram.com/accounts/logout","_blank"),window.location.href="".concat(h.a.serverURL,"/v/vip/logout")):window.location.href="/"}),12e4)}},{key:"componentWillUnmount",value:function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null)}},{key:"calculateModalPosition",value:function(){var e=this.modalDialog.current,t=e.offsetHeight>window.innerHeight?0:(window.innerHeight-e.offsetHeight)/2;e&&(this._modalStyle={position:"absolute",top:t,margin:"auto",left:0,bottom:0,right:0,opacity:1},this.forceUpdate())}},{key:"render",value:function(){var e=this.props,t=e.canvasRef,n=e.disabled,o=e.error,r=e.onContinue,i=e.onCancel;return c.a.createElement(l.Fragment,null,c.a.createElement("div",{style:_}),c.a.createElement("div",{style:T},c.a.createElement(d.a.Dialog,{ref:this.modalDialog,className:"px-1",style:this._modalStyle},c.a.createElement(d.a.Header,null,c.a.createElement(d.a.Title,null,"This is how other people will see you.")),c.a.createElement(d.a.Body,null,c.a.createElement("div",{className:"d-flex justify-content-center mb-3"},c.a.createElement(p.a,{style:C,variant:"dark",className:"mr-3",disabled:n,onClick:i},"Cancel"),c.a.createElement(p.a,{variant:"primary",disabled:n,onClick:r},"Continue")),c.a.createElement("div",{style:E,className:"position-relative w-100 bg-dark"},c.a.createElement(O,{ref:t}),o&&c.a.createElement("div",{className:"position-absolute d-flex align-items-center justify-content-center \n    text-danger text-center w-100 h-100",style:S},c.a.createElement("h4",null,o))),c.a.createElement("div",null,c.a.createElement("p",{className:"mb-0 mt-2 text-justify"},"Please use headphones. If you cannot hear noise from your device right now when you speak, this means your microphone is currently inactive, and nobody will be able to hear you during a video call."," "))))))}}])&&y(t.prototype,n),o&&y(t,o),i}(l.Component);P.propTypes={error:r.a.string,isVIP:r.a.bool,canvasRef:r.a.object,location:r.a.object,disabled:r.a.bool,onCancel:r.a.func,onContinue:r.a.func};var k=P,I=n(701);function M(e){return(M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function j(e,t){return(j=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=A(e);if(t){var r=A(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return V(this,n)}}function V(e,t){return!t||"object"!==M(t)&&"function"!=typeof t?x(e):t}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H,L,F,W,B,z={opacity:0,width:480,height:360,position:"absolute",top:0,left:0},G={width:480,height:360},Q=c.a.forwardRef((function(e,t){return c.a.createElement("div",{style:z},c.a.createElement("video",{ref:t,playsInline:!0,autoPlay:!0,style:G}))}));H="https://soundcloud.com/oembed?url=http%3A//soundcloud.com/forss/flickermood&format=js&callback=?",L=function(e){console.log(e)},F="_"+ +new Date,W=document.createElement("script"),B=document.getElementsByTagName("head")[0]||document.documentElement,window[F]=function(e){B.removeChild(W),L&&L(e)},W.src=H.replace("callback=?","callback="+F),B.appendChild(W);var Z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&j(e,t)}(i,e);var t,n,o,r=N(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),U(x(t=r.call(this,e)),"handleModalContinue",(function(){if(!t.state.isButtonDisabled){var e=t.props.isVIP,n=t.capture();t._detectFace?1===t.numFacesFound?(t.checkNudity(n),t.isAnalyzing?console.log("please wait while we analyze your photo"):console.log(" no esta analizando ")):t.numFacesFound>1?(t.setState({isButtonDisabled:!0,error:"Only one person can be in the camera view."}),t.errorTimeout=setTimeout((function(){t.errorTimeout=null,t.setState({error:null,isButtonDisabled:!1})}),5e3)):0===t.numFacesFound&&(e?(t.setState({isButtonDisabled:!0,error:"Face not detected.\nPlease try again."}),t.errorTimeout=setTimeout((function(){t.errorTimeout=null,t.setState({error:null,isButtonDisabled:!1})}),5e3)):(t.setState({isButtonDisabled:!0}),t.errorTimeout=setTimeout((function(){t.errorTimeout=null,t.setState({error:null,isButtonDisabled:!1})}),5e3))):t.sendCapturedAvatar(null)}})),U(x(t),"handleModalCancel",(function(){t.state.isButtonDisabled})),t.state={isPicoReady:!1,isButtonDisabled:!0,error:null},t.canvas=c.a.createRef(),t.video=c.a.createRef(),t.updateMemory=null,t.classifyRegion=null,t.animationFrameId=null,t.numFacesFound=0,t.isVideoReady=!1,t.isFindingFace=!1,t.isAnalyzing=!1,t.errorTimeout=null,t._isMounted=!1,t._detectFace=!0,t}return t=i,(n=[{key:"componentDidMount",value:function(){var e=this;a.a.parse(this.props.location.search),this._isMounted=!0,this.updateMemory=f.instantiate_detection_memory(5),fetch("https://raw.githubusercontent.com/nenadmarkus/pico/c2e81f9d23cc11d1a612fd21e4f9de0921a5d0d9/rnt/cascades/facefinder").then((function(e){return e.arrayBuffer()})).then((function(t){if(e._isMounted){var n=new Int8Array(t);e.classifyRegion=f.unpack_cascade(n),e.setState({isPicoReady:!0})}}))}},{key:"componentDidUpdate",value:function(){var e=this;if(!this.isFindingFace&&!this.isAnalyzing){var t=this.props.stream,n=this.canvas.current,o=this.video.current;if(t&&o&&!this.isVideoReady)return o.srcObject=t,void h.a.isVideoReady(o).then((function(){e.isVideoReady=!0,e.setState({isButtonDisabled:!1})})).catch((function(e){return console.log(e)}));if(this.isVideoReady&&n){this.isFindingFace=!0;var r=n.getContext("2d");!function t(){e.findFace(o,r),e.animationFrameId=requestAnimationFrame(t)}()}}}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.isVideoReady=!1,cancelAnimationFrame(this.animationFrameId)}},{key:"findFace",value:function(e,t){var n=0,o=e.videoWidth,r=e.videoHeight,i=t.canvas.width,a=t.canvas.height;r>o&&(r=Math.round(.75*o),n=Math.round((e.videoHeight-r)/2)),t.drawImage(e,0,n,o,r,0,0,i,a);var l=t.getImageData(0,0,i,a).data,c={pixels:this.rgbaToGrayscale(l,a,i),nrows:a,ncols:i,ldim:i},s=f.run_cascade(c,this.classifyRegion,{shiftfactor:.1,scalefactor:1.1,minsize:100,maxsize:1e3});s=this.updateMemory(s),s=f.cluster_detections(s,.2),this.numFacesFound=0;for(var u=0;u<s.length;++u)if(s[u][3]>50){this.numFacesFound++;var d=s[u][1],p=s[u][0],h=s[u][2],m=d-h/2,y=p-h/2;t.beginPath(),t.rect(m,y,h,h),t.lineWidth=3,t.strokeStyle="red",t.stroke()}}},{key:"capture",value:function(){var e=this.video.current,t=document.createElement("canvas"),n=0,o=e.videoWidth,r=e.videoHeight;r>o&&(r=Math.round(.75*o),n=Math.round((e.videoHeight-r)/2)),t.getContext("2d").drawImage(e,0,n,o,r,0,0,t.width,t.height);var i=document.createElement("canvas");return i.width=320,i.height=320,i.getContext("2d").drawImage(t,0,0,320,320),i}},{key:"rgbaToGrayscale",value:function(e,t,n){for(var o=new Uint8Array(t*n),r=0;r<t;++r)for(var i=0;i<n;++i)o[r*n+i]=(2*e[4*r*n+4*i+0]+7*e[4*r*n+4*i+1]+1*e[4*r*n+4*i+2])/10;return o}},{key:"sendCapturedAvatar",value:function(e){this.isFindingFace=!1,cancelAnimationFrame(this.animationFrameId),this.props.onFind(e)}},{key:"checkNudity",value:function(e){var t=this;this.isAnalyzing=!0,I.load().then((function(n){n.classify(e).then((function(n){t.isAnalyzing=!1,parseFloat(n[1].probability)>.5?(t.setState({isButtonDisabled:!0,error:"Inappropriate. \n Please try again."}),t.errorTimeout=setTimeout((function(){t.errorTimeout=null,t.setState({error:null,isButtonDisabled:!1})}),5e3)):t.sendCapturedAvatar(e.toDataURL("image/jpeg"))}))}))}},{key:"render",value:function(){var e=this.state,t=e.isPicoReady,n=e.isButtonDisabled,o=e.error,r=this.props,i=r.stream,a=r.avatar,s=r.isVIP;return!1===t||null===i?null:c.a.createElement(l.Fragment,null,!a&&c.a.createElement(Q,{ref:this.video}),this.isVideoReady&&!a&&c.a.createElement(k,{isVIP:s,canvasRef:this.canvas,stream:i,disabled:n,onContinue:this.handleModalContinue,onCancel:this.handleModalCancel,error:o}))}}])&&D(t.prototype,n),o&&D(t,o),i}(l.Component);Z.propTypes={avatar:r.a.string,stream:r.a.object,location:r.a.object,isVIP:r.a.bool,onFind:r.a.func};t.a=Object(s.f)(Z)},738:function(e,t,n){"use strict";var o=n(1),r=n.n(o),i=n(6),a=n.n(i),l=n(311),c=n(715),s=n(727),u=n(729),f=n.n(u);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v(e);if(t){var r=v(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return y(this,n)}}function y(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b={width:"100%",paddingTop:"75%",position:"relative"},g={position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"#dee3e7"},w={position:"fixed",top:0,left:0,bottom:0,right:0,backgroundColor:"#000",opacity:.5,zIndex:1040},E={position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:1040},R={backgroundColor:"#C5C8C8",borderColor:"#C5C8C8"},S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(u,e);var t,n,i,a=m(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=a.call(this,e)).state={isProfileImageLoaded:!1},t.image=r.a.createRef(),t.modalDialog=r.a.createRef(),t._modalStyle={position:"absolute",margin:0,top:0,left:0,opacity:0},t}return t=u,(n=[{key:"componentDidMount",value:function(){s.a.update(!0),this.calculateModalPosition()}},{key:"componentDidUpdate",value:function(){var e=this.props.callee,t=this.image.current;null!==e&&null!==t&&(t.src="/profile/".concat(e.avatarId),t.onload=function(){t.onload=null,t.onerror=null},t.onerror=function(){t.onload=null,t.onerror=null,t.src=f.a})}},{key:"componentWillUnmount",value:function(){s.a.update(!1)}},{key:"calculateModalPosition",value:function(){var e=this.modalDialog.current;if(e){var t=e.offsetHeight>window.innerHeight?0:(window.innerHeight-e.offsetHeight)/2;this._modalStyle={position:"absolute",margin:"auto",top:t,left:0,bottom:0,right:0,opacity:1},this.forceUpdate()}}},{key:"render",value:function(){var e=this.props.onCancel;return r.a.createElement(o.Fragment,null,r.a.createElement("div",{style:w}),r.a.createElement("div",{style:E},r.a.createElement(l.a.Dialog,{ref:this.modalDialog,className:"px-1",style:this._modalStyle},r.a.createElement(l.a.Header,null,r.a.createElement(l.a.Title,null,"Video Call request sent. Waiting for a response.")),r.a.createElement(l.a.Body,null,r.a.createElement("div",{className:"d-flex justify-content-center mb-3"},r.a.createElement(c.a,{style:R,variant:"dark",onClick:e},"Cancel Request")),r.a.createElement("div",{style:b},r.a.createElement("img",{ref:this.image,alt:"",crossOrigin:"anonymous",src:null,style:g,className:""}))))))}}])&&p(t.prototype,n),i&&p(t,i),u}(o.Component);S.propTypes={callee:a.a.object,onCancel:a.a.func},t.a=S},739:function(e,t,n){"use strict";var o=n(1),r=n.n(o),i=n(6),a=n.n(i),l=n(311),c=n(715),s=n(727),u=n(729),f=n.n(u);function d(e){return(d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=v(e);if(t){var r=v(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return y(this,n)}}function y(e,t){return!t||"object"!==d(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var b={width:"100%",paddingTop:"75%",position:"relative"},g={position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"#dee3e7"},w={position:"fixed",top:0,left:0,bottom:0,right:0,backgroundColor:"#000",opacity:.5,zIndex:1040},E={position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:1040},R={backgroundColor:"#C5C8C8",borderColor:"#C5C8C8"},S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(u,e);var t,n,i,a=m(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=a.call(this,e)).image=r.a.createRef(),t.modalDialog=r.a.createRef(),t._modalStyle={position:"absolute",margin:0,top:0,left:0,opacity:0},t._timeout=null,t}return t=u,(n=[{key:"componentDidMount",value:function(){var e=this;s.a.update(!0),this.calculateModalPosition(),this._timeout=setTimeout((function(){e._timeout=null,e.props.onDeny()}),15e3)}},{key:"componentDidUpdate",value:function(){var e=this.props.caller,t=this.image.current;null!==e&&null!==t&&(t.src="/profile/".concat(e.avatarId),t.onload=function(){t.onload=null,t.onerror=null},t.onerror=function(){t.onload=null,t.onerror=null,t.src=f.a})}},{key:"componentWillUnmount",value:function(){s.a.update(!1),this._timeout&&(clearTimeout(this._timeout),this._timeout=null)}},{key:"calculateModalPosition",value:function(){var e=this.modalDialog.current;if(e){var t=e.offsetHeight>window.innerHeight?0:(window.innerHeight-e.offsetHeight)/2;this._modalStyle={position:"absolute",margin:"auto",top:t,left:0,bottom:0,right:0,opacity:1},this.forceUpdate()}}},{key:"render",value:function(){var e=this.props,t=e.onAccept,n=e.onDeny;return r.a.createElement(o.Fragment,null,r.a.createElement("div",{style:w}),r.a.createElement("div",{style:E},r.a.createElement(l.a.Dialog,{ref:this.modalDialog,className:"px-1",style:this._modalStyle},r.a.createElement(l.a.Header,null,r.a.createElement(l.a.Title,null,"The person below is requesting a Video Call with you.")),r.a.createElement(l.a.Body,null,r.a.createElement("div",{className:"d-flex justify-content-center mb-3"},r.a.createElement(c.a,{variant:"primary",className:"mr-3",onClick:t},"Accept"),r.a.createElement(c.a,{style:R,variant:"dark",onClick:n},"Deny")),r.a.createElement("div",{style:b},r.a.createElement("img",{ref:this.image,alt:"",crossOrigin:"anonymous",src:null,style:g,className:""}))))))}}])&&p(t.prototype,n),i&&p(t,i),u}(o.Component);S.propTypes={caller:a.a.object,onAccept:a.a.func,onDeny:a.a.func},t.a=S},740:function(e,t,n){"use strict";var o=n(1),r=n.n(o),i=n(6),a=n.n(i),l=n(717),c=n(141),s=n(733),u=n.n(s),f=n(741),d=n.n(f);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=g(e);if(t){var r=g(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return v(this,n)}}function v(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?b(e):t}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var E={position:"absolute",width:"100%",height:"100%",top:0,left:0},R={position:"relative",height:"100%",overflow:"hidden"},S=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(s,e);var t,n,i,a=y(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),w(b(t=a.call(this,e)),"handleReportClick",(function(){t.props.onReport()})),w(b(t),"handleExitClick",(function(){t.props.onExit()})),t.state={isShowTip:!1,isShowButtons:!1,localVideoWidth:0,localVideoHeight:0,remoteVideoWidth:0,remoteVideoHeight:0},t.isLocalVideoReady=!1,t.isRemoteVideoReady=!1,t.localVideoRoot=r.a.createRef(),t.remoteVideoRoot=r.a.createRef(),t.customerName=r.a.createRef(),t.waterMark=r.a.createRef(),t.exitButton=r.a.createRef(),t.reportButton=r.a.createRef(),t.tipTimeout=null,t.buttonsTimeout=null,t}return t=s,(n=[{key:"componentDidUpdate",value:function(){var e=this,t=this.props,n=t.isStarted,o=t.localStream,r=t.remoteStream,i=t.onLocalVideoReady,a=t.onRemoteVideoReady,l=null!==this.localVideoRoot.current?this.localVideoRoot.current.firstChild:null,s=null!==this.remoteVideoRoot.current?this.remoteVideoRoot.current.firstChild:null;if(!1===n)return this.isLocalVideoReady=!1,this.isRemoteVideoReady=!1,l&&null!==l.srcObject&&(l.srcObject=null),void(s&&null!==s.srcObject&&(s.srcObject=null));null===l||null===o||this.isLocalVideoReady||(l.srcObject=o,c.a.isVideoReady(l).then((function(){e.isLocalVideoReady=!0,e.setState({localVideoWidth:l.videoWidth,localVideoHeight:l.videoHeight}),i()})).catch((function(e){return console.log(e)}))),null===s||null===r||this.isRemoteVideoReady||(s.srcObject=r,c.a.isVideoReady(s).then((function(){e.isRemoteVideoReady=!0,e.setState({remoteVideoWidth:s.videoWidth,remoteVideoHeight:s.videoHeight}),a()})).then((function(){e.showTip(),e.delayShowButtons()})).catch((function(e){return console.log(e)})));var u=this.exitButton.current,f=this.reportButton.current;null!==u&&u.addEventListener("click",this.handleExitClick),null!==f&&f.addEventListener("click",this.handleReportClick)}},{key:"componentWillUnmount",value:function(){var e=this.exitButton.current,t=this.reportButton.current;null!==e&&e.removeEventListener("click",this.handleExitClick),null!==t&&t.removeEventListener("click",this.handleReportClick),clearTimeout(this.tipTimeout),clearTimeout(this.buttonsTimeout),this.tipTimeout=null,this.buttonsTimeout=null}},{key:"showTip",value:function(){var e=this;this.tipTimeout||(this.setState({isShowTip:!0}),this.tipTimeout=setTimeout((function(){e.setState({isShowTip:!1})}),2e3))}},{key:"delayShowButtons",value:function(){var e=this;this.buttonsTimeout||(this.buttonsTimeout=setTimeout((function(){e.setState({isShowButtons:!0})}),2e3))}},{key:"render",value:function(){var e=this.state,t=e.isShowTip,n=e.isShowButtons,i=e.localVideoWidth,a=e.localVideoHeight,c=e.remoteVideoWidth,s=e.remoteVideoHeight,f=this.props,p=f.vip,h=f.customer,m=f.isUserVIP,y=f.windowWidth,v=f.windowHeight,b=f.localStream,g=f.remoteStream,w=f.isCanReport,S=f.isPaidCall,C=this.localVideoRoot.current,_=this.remoteVideoRoot.current,T=y>v,O=null!==g&&this.isRemoteVideoReady,P={display:"none"},k=0,I=0;if(O&&null!==_){var M=_.offsetWidth,D=_.offsetHeight,j=1;P={position:"absolute",display:"block",width:c,height:s,top:(D-s*(j=T?c>s?D/s:Math.ceil(1.333333333333333*D)/c:D/s))/2,left:I=(M-(k=c*j))/2,transformOrigin:"0 0",transform:"scale(".concat(j,")")}}var N=null!==b&&this.isLocalVideoReady,V={display:"none"};if(O&&N&&null!==C){var x=C.offsetWidth,A=C.offsetHeight,U=i>a?Math.ceil(x/56.25*100)/i:x/i;V={position:"absolute",display:"block",width:i,height:a,top:(A-a*U)/2,left:(x-i*U)/2,transformOrigin:"0 0",transform:"scale(".concat(U,")")}}var H={position:"absolute",overflow:"hidden",width:"6.5em",height:"6.5em",bottom:0,left:I<0?0:I},L=k<=y?k:y,F={position:"absolute",backgroundColor:"rgba(0, 1, 0, 0.5)",width:L,top:0,left:I<0?0:I,opacity:L>0?1:0},W=this.waterMark.current,B=1,z=0,G=0,Q=1;if(null!==W){var Z=C.offsetWidth,Y=C.offsetHeight,q=C.offsetTop;B=W.offsetWidth,G=(Y-W.offsetHeight)/1.5+q,(z=Z)+B>y&&(Q=(y-Z)/B)}var J={position:"absolute",opacity:.65,top:G,left:z,transformOrigin:"0 0",transform:"scale(".concat(Q,")")},X=this.customerName.current,K=I<=0?0:y-k-I,$=0;S&&X&&($=X.offsetHeight);var ee={position:"absolute",width:"2.75em",height:"2.75em",top:$,right:K,cursor:"pointer"},te={position:"absolute",width:"2.75em",height:"2.75em",top:$,left:I>0?I:0,cursor:"pointer"};return r.a.createElement("div",{style:E,className:"bg-white"},r.a.createElement("div",{ref:this.remoteVideoRoot,style:R},r.a.createElement("video",{autoPlay:!0,playsInline:!0,style:P,className:"bg-secondary"},"Your browser does not support the video tag")),r.a.createElement("div",{ref:this.localVideoRoot,style:H,className:"ml-2 mb-2"},r.a.createElement("video",{autoPlay:!0,playsInline:!0,muted:!0,style:V,className:"bg-dark"},"Your browser does not support the video tag")),S&&r.a.createElement(o.Fragment,null,m&&r.a.createElement("div",{ref:this.customerName,style:F,className:"text-center text-light pt-1"},r.a.createElement("h2",null,h.fullname)),!1===m&&r.a.createElement("div",{ref:this.waterMark,style:J,className:"text-light pl-3 pr-2"},r.a.createElement("h4",{className:"m-0"},"@".concat(p.username)),r.a.createElement("h2",{className:"m-0"},r.a.createElement("strong",null,"thechatmatrix.com")))),n&&(!1===S||m)&&r.a.createElement("img",{ref:this.exitButton,alt:"",src:d.a,style:ee,className:"mt-3 mr-3"}),n&&w&&r.a.createElement("img",{ref:this.reportButton,src:u.a,alt:"",style:te,className:"mt-3 ml-3"}),t&&!S&&r.a.createElement("div",{style:{position:"absolute",width:"100%",height:"100%",top:0}},r.a.createElement("div",{className:"d-flex flex-column justify-content-center align-items-center h-100"},r.a.createElement(l.a,{variant:"light",className:"text-center text-dark"},r.a.createElement("strong",null,"Please use headphones to prevent echoing.")))))}}])&&h(t.prototype,n),i&&h(t,i),s}(o.Component);S.propTypes={localStream:a.a.object,remoteStream:a.a.object,windowHeight:a.a.number,windowWidth:a.a.number,isStarted:a.a.bool,isUserVIP:a.a.bool,isCanReport:a.a.bool,isPaidCall:a.a.bool,onLocalVideoReady:a.a.func,onRemoteVideoReady:a.a.func,onReport:a.a.func,onExit:a.a.func,customer:a.a.object,vip:a.a.object},t.a=S},741:function(e,t,n){e.exports=n.p+"c5f5b6a74046734d066078932c87ebaa.png"},742:function(e,t,n){e.exports=n.p+"773b51ca105ca2b06de5ea15a572f614.png"},743:function(e,t,n){e.exports=n.p+"d4daa648b53195bc875c94c4e230e171.png"}}]);