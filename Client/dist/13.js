(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{760:function(e,t,n){"use strict";n.r(t);var r=n(1),o=n.n(r),a=n(6),i=n.n(a),l=n(719),c=n(689),s=n.n(c),u=n(690),f=n.n(u),p=n(691),d=n.n(p),m=n(697),h=n.n(m),y=n(727),v=n(141),b=n(730),g=n(731),w=n(311),E=n(715);function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k(e);if(t){var o=k(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return I(this,n)}}function I(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var R={position:"fixed",top:0,left:0,bottom:0,right:0,backgroundColor:"#000",opacity:.5,zIndex:1040},D={position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:1040},N={backgroundColor:"#C5C8C8",borderColor:"#C5C8C8"},O={backgroundColor:"#007BFF",borderColor:"#007BFF"},x=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(l,e);var t,n,a,i=_(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,e)).modalDialog=o.a.createRef(),t._modalStyle={position:"absolute",margin:0,top:0,left:0,opacity:0},t}return t=l,(n=[{key:"componentDidMount",value:function(){this.calculateModalPosition()}},{key:"calculateModalPosition",value:function(){var e=this.modalDialog.current;if(e){var t=e.offsetHeight>window.innerHeight?0:(window.innerHeight-e.offsetHeight)/2;this._modalStyle={position:"absolute",margin:"auto",top:t,left:0,bottom:0,right:0,opacity:1},this.forceUpdate()}}},{key:"render",value:function(){var e=this.props,t=e.onYes,n=e.onNo,a=o.a.createElement("a",{href:"/terms-of-use",target:"_blank"},"here"),i=o.a.createElement("a",{href:"/privacy-policy",target:"_blank"},"here");return o.a.createElement(r.Fragment,null,o.a.createElement("div",{style:R}),o.a.createElement("div",{style:D},o.a.createElement(w.a.Dialog,{size:"sm",ref:this.modalDialog,className:"px-1",style:this._modalStyle},o.a.createElement(w.a.Body,{className:"text-center"},o.a.createElement("p",{className:"lead"},"Do you completely understand and completely agree with all of the content in the links ",a," and ",i,"?")),o.a.createElement(w.a.Footer,null,o.a.createElement(E.a,{style:O,variant:"primary",size:"lg",className:"ml-auto w-100",onClick:t},"Yes"),o.a.createElement(E.a,{variant:"dark",size:"lg",style:N,className:"mr-auto w-100",onClick:n},"No")))))}}])&&C(t.prototype,n),a&&C(t,a),l}(r.Component);x.propTypes={onYes:i.a.func,onNo:i.a.func};var U=x,A=n(732),T=n(737),j=n(723);function M(e){var t=e.showNavbar,n=e.showFooter,a=e.windowWidth,i=e.windowHeight;if(a<=0||i<=0)return null;var l=0,c=0;if(a>i)c=.75*(l=i);else{var s=.75*((l=a)/3);c=(Math.round(i/s)-1)*s}var u=(i-c)/2,f={height:u,paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0},p=l/764,d={height:u,width:a},m={fontFamily:"Gotham Rounded",fontWeight:"bold",fontStyle:"normal",whiteSpace:"nowrap",fontSize:"2.5em",letterSpacing:"0.6em",paddingLeft:"0.6em",transform:"scale(".concat(p,")")},h={height:u},y={fontFamily:"Gotham Rounded",fontWeight:"bold",fontStyle:"normal",whiteSpace:"nowrap",transform:"scale(".concat(60*p/24*.5,")")};return o.a.createElement(r.Fragment,null,t&&o.a.createElement(j.a,{expand:"lg",bg:"white",variant:"light",fixed:"top",style:f},o.a.createElement("div",{style:d,className:"d-flex align-items-center justify-content-center"},o.a.createElement("div",{style:m,className:"m-0 text-secondary"},"THE CHAT MATRIX"))),n&&o.a.createElement("div",{style:h,className:"d-flex align-items-center justify-content-center fixed-bottom bg-white text-secondary"},o.a.createElement("div",{style:y},"Copyright ©. All rights reserved.")))}M.propTypes={windowWidth:i.a.number,windowHeight:i.a.number,showNavbar:i.a.bool,showFooter:i.a.bool};var V=M,L=n(725),F=n(724),H=n(729),W=n.n(H),Y=n(733),z=n.n(Y);function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function G(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$(e);if(t){var o=$(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return J(this,n)}}function J(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?X(e):t}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $(e){return($=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var K={top:0,left:0},Z={position:"absolute",width:"1.5em",height:"1.5em",right:"0.8em",bottom:"0.75em",opacity:.5,cursor:"pointer"};function ee(e){return o.a.createElement(L.a,{id:e.userId,className:"p-0"},o.a.createElement("img",{src:e.profilePicture,alt:"",crossOrigin:"anonymous",width:240,height:240}),o.a.createElement("div",{className:"mx-2 my-1 text-center"},o.a.createElement("strong",null,e.fullname),o.a.createElement("br",null),o.a.createElement("strong",null,"(@",e.username,")"),o.a.createElement("br",null),e.followedBy," followers"))}var te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(i,e);var t,n,r,a=G(i);function i(e){var t,n,r,l;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),t=a.call(this,e),n=X(t),l=function(e){var n=t.props.user;if("report"===e.target.id)t.props.onReport(n);else{if(n.isBusy)return;t.props.onSelect(n)}},(r="handleClick")in n?Object.defineProperty(n,r,{value:l,enumerable:!0,configurable:!0,writable:!0}):n[r]=l,t.state={isLoadingAvatar:!0},t.root=o.a.createRef(),t.avatarImage=o.a.createRef(),t}return t=i,(n=[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.guestID,r=t.user,o=this.root.current,a=this.avatarImage.current;if(null!==a){var i="".concat(v.a.serverURL,"/profile/").concat(r.avatarId);a.src=i,a.onload=function(){a.onload=null,a.onerror=null,e.setState({isLoadingAvatar:!1})},a.onerror=function(t){a.onload=null,a.onerror=null,a.src=W.a,e.setState({isLoadingAvatar:!1})}}null!==o&&r.userId!==n&&"DUMMY"!==r.username&&o.addEventListener("click",this.handleClick)}},{key:"componentWillUnmount",value:function(){var e=this.root.current;null!==e&&e.removeEventListener("click",this.handleClick)}},{key:"render",value:function(){var e=this.props,t=e.guestID,n=e.guestIP,r=e.user,a=e.width,i=e.height,l=e.column,c=e.row,s=this.state.isLoadingAvatar,u=t===r.userId,f="DUMMY"===r.username,p={position:"absolute",width:a,height:i,top:i*c,left:a*l,cursor:f||u?"auto":"pointer"},d={position:"absolute",width:a,height:i,top:0,left:0,bottom:0,right:0,float:"left"},m={position:"absolute",top:0,left:0,bottom:0,right:0,opacity:s?0:1},h=r.isVip?"img-thumbnail w-100 h-100 bg-primary anim":"img-thumbnail w-100 h-100 anim";return o.a.createElement("div",{ref:this.root,style:p},o.a.createElement("img",{src:W.a,loading:"lazy",crossOrigin:"anonymous",alt:"",className:"img-thumbnail w-100 h-100 animroot"}),!f&&o.a.createElement("img",{ref:this.avatarImage,crossOrigin:"anonymous",loading:"lazy",alt:"",className:h,style:m}),!1===f&&r.isVip&&!v.a.isMobile&&o.a.createElement(F.a,{trigger:"hover",placement:"auto",overlay:ee(r)},o.a.createElement("div",{style:d})),!1===f&&!1===u&&!1===r.isVip&&r.isBusy&&o.a.createElement("div",{style:K,className:"position-absolute w-100 h-100 d-flex align-items-center justify-content-center"},o.a.createElement("h2",{className:"text-danger mb-0"},"BUSY")),!1===f&&!1===u&&!1===r.isVip&&n!==r.IP&&o.a.createElement("img",{id:"report",alt:"",src:z.a,style:Z}))}}])&&q(t.prototype,n),r&&q(t,r),i}(r.Component);te.propTypes={guestID:i.a.string,guestIP:i.a.string,user:i.a.object,width:i.a.number,height:i.a.number,row:i.a.number,column:i.a.number,onReport:i.a.func,onSelect:i.a.func};var ne=te,re=n(710),oe=n(708);function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(e,t){return(le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ce(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=fe(e);if(t){var o=fe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return se(this,n)}}function se(e,t){return!t||"object"!==ae(t)&&"function"!=typeof t?ue(e):t}function ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fe(e){return(fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var de=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&le(e,t)}(l,e);var t,n,a,i=ce(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),pe(ue(t=i.call(this,e)),"handleNextClick",(function(){t.isScrolling||(t.isScroll=!0,t.props.onNextPage(t.numPages))})),pe(ue(t),"handlePrevClick",(function(){t.isScrolling||(t.isScroll=!0,t.props.onPrevPage(t.numPages))})),pe(ue(t),"handleSwiped",(function(e){if(!(t.numPages<=1))switch(e.dir){case"Down":case"Right":t.handlePrevClick();break;default:t.handleNextClick()}})),t.grid=o.a.createRef(),t.gridHeight=0,t.numPages=0,t.isScroll=!1,t.isScrolling=!1,t}return t=l,(n=[{key:"componentDidUpdate",value:function(e){var t=this;if(!this.isScrolling&&!1!==this.isScroll){var n=this.grid.current;if(null!==n){var r=e.page<this.props.page?-1:1,o=this.gridHeight*r;re.a.to(n,.25,{y:"+=".concat(o),onStart:function(){t.isScrolling=!0},onComplete:function(){t.isScroll=!1,t.isScrolling=!1}})}}}},{key:"render",value:function(){var e=this.props,t=e.users,n=e.page,a=e.guestID,i=e.guestIP,l=e.windowWidth,c=e.windowHeight,s=e.onSelect,u=e.onReport;if(l<=0||c<=0)return null;var f=l>c,p=f?c:l,d=Math.round(p/3),m=Math.round(.75*d),h=f?.75*p:(Math.round(c/m)-1)*m,y=3*Math.round(h/m),v=Math.ceil(t.length/y);v<=0&&(v=1),this.gridHeight=h,this.numPages=v;for(var b=y*v-t.length+3,g=[],w=0;w<b;w++){var S={userId:(1e9*(w+1)).toString(),username:"DUMMY"};g.push(S)}var C=t.concat(g),P=!0,_=!0;v>1&&(_=n===v-1,P=n<1&&n<=v-1);var I={position:"absolute",top:(c-h)/2,left:(l-p)/2,width:p+1,height:h,overflow:"hidden"},k=(c-h)/2,R={position:"absolute",top:0,left:I.left,width:p,height:k,outline:"none"},D={position:"absolute",bottom:0,left:I.left,width:p,height:k,outline:"none"};return o.a.createElement(r.Fragment,null,o.a.createElement(oe.a,{onSwiped:this.handleSwiped},o.a.createElement("div",{style:I},o.a.createElement("div",{ref:this.grid},C.map((function(e,t){return o.a.createElement(ne,{key:e.userId,user:e,guestID:a,guestIP:i,width:d,height:m,column:t%3,row:Math.floor(t/3),onSelect:s,onReport:u})}))))),o.a.createElement(V,{showNavbar:P,showFooter:_,windowWidth:l,windowHeight:c}),v>1&&o.a.createElement(r.Fragment,null,o.a.createElement(E.a,{variant:"primary",size:"sm",style:R,className:"text-center shadow-none",onClick:this.handlePrevClick},o.a.createElement("span",{className:"oi oi-chevron-top"})),o.a.createElement(E.a,{variant:"primary",size:"sm",style:D,className:"text-center shadow-none",onClick:this.handleNextClick},o.a.createElement("span",{className:"oi oi-chevron-bottom"}))))}}])&&ie(t.prototype,n),a&&ie(t,a),l}(r.Component);de.propTypes={users:i.a.array,guestID:i.a.string,guestIP:i.a.string,page:i.a.number,windowWidth:i.a.number,windowHeight:i.a.number,onNextPage:i.a.func,onPrevPage:i.a.func,onSelect:i.a.func,onReport:i.a.func};var me=de;function he(e){return(he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ve(e,t){return(ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ee(e);if(t){var o=Ee(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ge(this,n)}}function ge(e,t){return!t||"object"!==he(t)&&"function"!=typeof t?we(e):t}function we(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ce=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}(i,e);var t,n,r,a=be(i);function i(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),Se(we(t=a.call(this,e)),"handleSelect",(function(e){t.props.io&&t.props.onSelect(e)})),Se(we(t),"handleReport",(function(e){t.props.io.emit("REPORT_USER",e)})),Se(we(t),"handleNextPage",(function(e){var n=t.state.page;n<e-1&&t.setState({page:n+1})})),Se(we(t),"handlePrevPage",(function(){var e=t.state.page;e>0&&t.setState({page:e-1})})),t.state={users:[],page:0},t._isMounted=!1,t._isEventsAdded=!1,t._pollInterval=null,t}return t=i,(n=[{key:"componentDidMount",value:function(){var e=this;this._isMounted=!0;var t=!1;this._pollInterval=setInterval((function(){t||(t=!0,s.a.get("".concat(v.a.serverURL,"/c/chat/users")).then((function(t){e._isMounted&&e.setState({users:t.data})})).catch((function(e){return console.log(e)})).finally((function(){t=!1})))}),1e3),this.addIOEvents()}},{key:"componentDidUpdate",value:function(){this.addIOEvents()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1;var e=this.props.io;e&&(e.off("USERS_LOADED"),e.off("USERS_UPDATED"),e.off("UPDATE_BUSY_STATUS"),e.off("UPDATE_AVATAR")),clearInterval(this._pollInterval),this._isEventsAdded=!1,this._pollInterval=null}},{key:"addIOEvents",value:function(){var e=this;if(!this._isEventsAdded){var t=this.props.io;t&&(clearInterval(this._pollInterval),this._isEventsAdded=!0,this._pollInterval=null,t.on("USERS_LOADED",(function(t){return e.setState({users:t})})),t.on("USERS_UPDATED",(function(){return t.emit("LOAD_USERS")})),t.on("UPDATE_BUSY_STATUS",(function(){return t.emit("LOAD_USERS")})),t.on("UPDATE_AVATAR",(function(){return t.emit("LOAD_USERS")})),t.emit("LOAD_USERS"))}}},{key:"render",value:function(){var e=this.state,t=e.users,n=e.page,r=this.props,a=r.guestID,i=r.guestIP,l=r.windowWidth,c=r.windowHeight,s="object"===he(t)?t:[];return o.a.createElement(me,{users:s,page:n,guestID:a,guestIP:i,windowWidth:l,windowHeight:c,onSelect:this.handleSelect,onReport:this.handleReport,onNextPage:this.handleNextPage,onPrevPage:this.handlePrevPage})}}])&&ye(t.prototype,n),r&&ye(t,r),i}(r.Component);Ce.propTypes={io:i.a.object,guestID:i.a.string,guestIP:i.a.string,windowWidth:i.a.number,windowHeight:i.a.number,onSelect:i.a.func};var Pe=Ce,_e=n(734),Ie=n(736);function ke(e){var t=e.userID,n=e.vip,r=e.stream,a=e.users,i=e.onExit,l=null!==n?"".concat(n.fullname," (@").concat(n.username,")"):"[VIP]",c=a.find((function(e){return e.userId===t})),s=a.indexOf(c)+1;return o.a.createElement("div",{className:"text-center px-3 px-md-5"},o.a.createElement("div",{className:"pt-4 pb-3"},o.a.createElement("p",{className:"m-0 pb-1"},o.a.createElement("small",null,"This is how you will look during the video call:")),o.a.createElement(Ie.a,{stream:r})),o.a.createElement("div",null,"You are number"),o.a.createElement("div",{className:"text-success"},s),o.a.createElement("div",null,"in the queue"),o.a.createElement("div",{className:"my-3"},o.a.createElement("small",null,"The lower your number, the closer you are getting to being greeted by ",l," via a video call. Please use ",o.a.createElement("b",null,"headphones")," to prevent echoing during the video call. Don't go anywhere! But if you must exit the queue, please press ",o.a.createElement("a",{href:"/chat",onClick:i},"here"),". Payment is not taken from your card before your video call begins.")))}ke.propTypes={userID:i.a.string,vip:i.a.object,users:i.a.array,stream:i.a.object,onExit:i.a.func};var Re=ke;function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ae(e);if(t){var o=Ae(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ue(this,n)}}function Ue(e,t){return!t||"object"!==De(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ae(e){return(Ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Te={position:"fixed",top:0,left:0,bottom:0,right:0,backgroundColor:"#000",opacity:.5,zIndex:1040},je={position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:1040},Me={backgroundColor:"#C5C8C8",borderColor:"#C5C8C8"},Ve={backgroundColor:"#007BFF",borderColor:"#007BFF"},Le=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(l,e);var t,n,a,i=xe(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(t=i.call(this,e)).modalDialog=o.a.createRef(),t._modalStyle={position:"absolute",margin:0,top:0,left:0,opacity:0},t}return t=l,(n=[{key:"componentDidMount",value:function(){y.a.update(!0),this.calculateModalPosition()}},{key:"componentWillUnmount",value:function(){y.a.update(!1)}},{key:"calculateModalPosition",value:function(){var e=this.modalDialog.current;if(e){var t=e.offsetHeight>window.innerHeight?0:(window.innerHeight-e.offsetHeight)/2;this._modalStyle={position:"absolute",margin:"auto",top:t,left:0,right:0,bottom:0,opacity:1},this.forceUpdate()}}},{key:"render",value:function(){var e=this.props,t=e.user,n=e.onYes,a=e.onNo,i="",l="";null!==t&&(i="instagram.com/".concat(t.username),l="https://www.".concat(i));var c=o.a.createElement("a",{href:"/l/links/vip-video-call-terms-and-conditions",target:"_blank"},"here");return o.a.createElement(r.Fragment,null,o.a.createElement("div",{style:Te}),o.a.createElement("div",{style:je},o.a.createElement(w.a.Dialog,{ref:this.modalDialog,className:"px-1",style:this._modalStyle},o.a.createElement(w.a.Header,null,o.a.createElement(w.a.Title,null,"VIP Video Greeting")),o.a.createElement(w.a.Body,{className:"text-center"},o.a.createElement("p",{className:"mb-2"},"You are requesting a very quick greeting (via a live 1-to-1 video call) with the following VIP (Instagram account holder):"),o.a.createElement("p",null,o.a.createElement("a",{href:l,target:"_blank",rel:"noopener noreferrer"},o.a.createElement("strong",null,i))),o.a.createElement("p",{className:"mb-2"},"Do you completely understand and completely agree with all of the content in the link ",c,"?")),o.a.createElement(w.a.Footer,null,o.a.createElement(E.a,{style:Ve,variant:"primary",size:"lg",className:"mr-3 ml-auto w-100",onClick:n},"Yes"),o.a.createElement(E.a,{style:Me,variant:"dark",size:"lg",className:"mr-auto w-100",onClick:a},"No")))))}}])&&Ne(t.prototype,n),a&&Ne(t,a),l}(r.Component);Le.propTypes={user:i.a.object,onYes:i.a.func,onNo:i.a.func};var Fe=Le,He=n(722);function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ye(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ze(e,t){return(ze=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Be(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ge(e);if(t){var o=Ge(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return qe(this,n)}}function qe(e,t){return!t||"object"!==We(t)&&"function"!=typeof t?Qe(e):t}function Qe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ge(e){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Xe=null,$e={position:"fixed",top:0,left:0,bottom:0,right:0,backgroundColor:"#000",opacity:.5,zIndex:1040},Ke={position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:1040},Ze=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ze(e,t)}(l,e);var t,n,a,i=Be(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),Je(Qe(t=i.call(this,e)),"handleOnEnter",(function(){y.a.update(!0);var e=t.input.current;e&&(Xe&&(e.value=Xe),v.a.isMobile?e.blur():e.focus())})),Je(Qe(t),"handleSubmit",(function(e){var n=t.input.current;Xe=n.value,e.preventDefault(),n.value||(n.value="Dude"),t.props.onSubmit(n.value)})),t.input=o.a.createRef(),t.modalDialog=o.a.createRef(),t._modalStyle={position:"absolute",margin:0,top:0,left:0,opacity:0},t}return t=l,(n=[{key:"componentDidMount",value:function(){this.handleOnEnter(),this.calculateModalPosition()}},{key:"componentWillUnmount",value:function(){y.a.update(!1)}},{key:"calculateModalPosition",value:function(){var e=this.modalDialog.current;if(e){var t=e.offsetHeight>window.innerHeight?0:(window.innerHeight-e.offsetHeight)/2;this._modalStyle={position:"absolute",margin:"auto",top:t,left:0,bottom:0,right:0,opacity:1},this.forceUpdate()}}},{key:"render",value:function(){var e=this.props,t=e.user,n=e.onCancel,a=null!==t?t.fullname:"",i="Please enter your name below. This will be passed onto ".concat(a,". \n        Your name is temporarily stored by The Chat Matrix.");return o.a.createElement(r.Fragment,null,o.a.createElement("div",{style:$e}),o.a.createElement("div",{style:Ke},o.a.createElement(w.a.Dialog,{size:"sm",ref:this.modalDialog,className:"px-1",style:this._modalStyle},o.a.createElement(w.a.Header,{closeButton:!0,onHide:n}),o.a.createElement(w.a.Body,{className:"text-center"},o.a.createElement("p",{className:"lead"},i),o.a.createElement(He.a,{onSubmit:this.handleSubmit},o.a.createElement(He.a.Control,{ref:this.input,placeholder:"Name",className:"font-weight-bold mb-2",maxLength:15,autoFocus:!0}),o.a.createElement(E.a,{variant:"primary",type:"submit",className:"w-100"},"Submit"))))))}}])&&Ye(t.prototype,n),a&&Ye(t,a),l}(r.Component);Ze.propTypes={user:i.a.object,show:i.a.bool,onSubmit:i.a.func,onCancel:i.a.func};var et=Ze,tt=n(718);function nt(e){return(nt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ot(e,t){return(ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function at(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ct(e);if(t){var o=ct(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return it(this,n)}}function it(e,t){return!t||"object"!==nt(t)&&"function"!=typeof t?lt(e):t}function lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ct(e){return(ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ut=window.Stripe,ft={position:"fixed",top:0,left:0,bottom:0,right:0,backgroundColor:"#000",opacity:.5,zIndex:1040},pt={position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:1040},dt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ot(e,t)}(l,e);var t,n,a,i=at(l);function l(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),st(lt(t=i.call(this,e)),"handleSubmit",(function(e){e.preventDefault(),""===t.cardNumber.trim()&&(t.state.cardNumberError="is-invalid"),""===t.cardCVC.trim()&&(t.state.cardCVCError="is-invalid"),""===t.cardExpiry.trim()&&(t.state.cardExpiryError="is-invalid");var n=t.props,r=n.details,o=n.vip,a=n.userID;t.setState({isProcessing:!0}),t.stripe.createPaymentMethod("card",t.stripeCardNumber).then((function(e){e.error?(console.log(e.error),t.setState({isProcessing:!1})):s.a.post("".concat(v.a.serverURL,"/s/stripe/auth_payment"),{vip_id:o.userId,customer_id:a,payment_method_id:e.paymentMethod.id,amount:r.amount}).then((function(e){t.handleServerResponse(e.data),y.a.update(!0)}))}))})),st(lt(t),"handleEnter",(function(){t.setState({isProcessing:!1});var e=t.props.details;if(null!==e){var n=t.cardNumber.current,r=t.cardExpiry.current,o=t.cardCVC.current;t.stripe=ut(e.key);var a=t.stripe.elements(),i={base:{fontSize:"16px",fontSmoothing:"antialiased"},invalid:{color:"#fa755a"}};t.stripeCardNumber=a.create("cardNumber",{placeholder:"Card Number",style:i}),t.stripeCardNumber.mount(n),t.stripeCardNumber.on("ready",(function(){v.a.isMobile||t.stripeCardNumber.focus(),t.setState({isStripeElementsReady:!0})})),t.stripeCardExpiry=a.create("cardExpiry",{placeholder:"MM/YY",style:i}),t.stripeCardExpiry.mount(r),t.stripeCardCVC=a.create("cardCvc",{placeholder:"CVC",style:i}),t.stripeCardCVC.mount(o)}})),st(lt(t),"handleExit",(function(){var e=t.cardNumber.current,n=t.cardExpiry.current,r=t.cardCVC.current;t.stripe=null,t.stripeCardNumber.unmount(e),t.stripeCardExpiry.unmount(n),t.stripeCardCVC.unmount(r),t.stripeCardNumber=null,t.stripeCardExpiry=null,t.stripeCardCVC=null})),t.state={isProcessing:!1,isStripeElementsReady:!1,stripe:null,cardNumberError:"",cardCVCError:"",cardExpiryError:""},t.cardNumber=o.a.createRef(),t.cardExpiry=o.a.createRef(),t.cardCVC=o.a.createRef(),t.modalDialog=o.a.createRef(),t.stripe=null,t.stripeCardNumber=null,t.stripeCardExpiry=null,t.stripeCardCVC=null,t._modalStyle={position:"absolute",width:"30rem",margin:0,top:0,left:0,opacity:0},t}return t=l,(n=[{key:"componentDidMount",value:function(){y.a.update(!0),this.handleEnter(),this.calculateModalPosition()}},{key:"componentWillUnmount",value:function(){y.a.update(!1),this.handleExit()}},{key:"calculateModalPosition",value:function(){var e=this.modalDialog.current,t=e.offsetHeight>window.innerHeight?0:(window.innerHeight-e.offsetHeight)/2;e&&(this._modalStyle={position:"absolute",width:"20rem",margin:"auto",top:t,left:0,right:0,bottom:0,opacity:1},this.forceUpdate())}},{key:"handleServerResponse",value:function(e){e.error?console.log(e.error):e.requires_action?this.handleAction(e):(console.log("payment success"),this.props.onSubmit(e))}},{key:"handleAction",value:function(e){var t=this,n=this.props,r=n.details,o=n.vip,a=n.userID;this.stripe.handleCardAction(e.payment_intent_client_secret).then((function(e){e.error?console.log(e.error):s.a.post("".concat(v.a.serverURL,"/s/stripe/auth_payment"),{vip_id:o.userId,customer_id:a,amount:r.amount,payment_intent_id:e.paymentIntent.id}).then((function(e){return e.data})).then((function(e){console.log("payment success"),t.handleServerResponse(e)}))}))}},{key:"render",value:function(){var e=this.state,t=e.isProcessing,n=e.isStripeElementsReady,a=this.props,i=a.details,l=a.onCancel,c=null!==i?"Pay $".concat(parseFloat(i.amount/100).toFixed(2)):"Pay";return t&&(c="Processing..."),o.a.createElement(r.Fragment,null,o.a.createElement("div",{style:ft}),o.a.createElement("div",{style:pt},o.a.createElement(w.a.Dialog,{ref:this.modalDialog,className:"px-1",style:this._modalStyle},o.a.createElement(w.a.Header,{closeButton:!0,onHide:l},o.a.createElement(w.a.Title,null,"Pay with Card ",o.a.createElement("a",{href:"/payment-info"},"ⓘ"))),o.a.createElement(w.a.Body,{className:"text-center p-2"},o.a.createElement(He.a,{onSubmit:this.handleSubmit},o.a.createElement(tt.a,{className:"mb-2"},o.a.createElement("span",{ref:this.cardNumber,className:"form-control"+this.state.cardNumberError})),o.a.createElement(tt.a,{className:"mb-2"},o.a.createElement("span",{ref:this.cardExpiry,className:"form-control"+this.state.cardExpiryError}),o.a.createElement("span",{ref:this.cardCVC,className:"form-control"+this.state.cardCVCError})),o.a.createElement(E.a,{variant:"primary",type:"submit",className:"font-weight-bold w-100",disabled:t||!n},c))))))}}])&&rt(t.prototype,n),a&&rt(t,a),l}(r.Component);dt.propTypes={details:i.a.object,vip:i.a.object,userID:i.a.string,onSubmit:i.a.func,onCancel:i.a.func};var mt=dt,ht=n(728),yt=n(206);function vt(e){return(vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function bt(e,t,n,r,o,a,i){try{var l=e[a](i),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,o)}function gt(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){bt(a,r,o,i,l,"next",e)}function l(e){bt(a,r,o,i,l,"throw",e)}i(void 0)}))}}function wt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Et(e,t){return(Et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function St(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_t(e);if(t){var o=_t(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ct(this,n)}}function Ct(e,t){return!t||"object"!==vt(t)&&"function"!=typeof t?Pt(e):t}function Pt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _t(e){return(_t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function It(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var kt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Et(e,t)}(u,e);var t,n,r,a,i,c=St(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),It(Pt(t=c.call(this,e)),"handleWindowResize",(function(){t.setState({windowWidth:window.innerWidth,windowHeight:window.innerHeight})})),It(Pt(t),"handleWindowBlur",(function(){!v.a.isMobile&&!t._isShowNameFormModal&&t._isShowCheckoutForm})),It(Pt(t),"handleUserSelect",(function(e){if(!t._isSelectedUser){t._isSelectedUser=!0;var n=t.state.io;e.isVip?t.setState({vip:e}):n.emit("SEND_REQUEST",e)}})),It(Pt(t),"handleCallAccept",(function(){t.state.io.emit("ACCEPT_REQUEST")})),It(Pt(t),"handleCallStart",(function(){g.a.stop(),t.setState({isCallStarted:!0})})),It(Pt(t),"handleCallExit",(function(){var e=t.state.io;g.a.reset(),t.setState({isCallStarted:!1,isVIPCallConfirmed:!1,isNameSubmitted:!1,vip:null,queue:null}),e.emit("LEAVE_QUEUE"),e.emit("LOAD_USERS")})),It(Pt(t),"handleVIPCallYes",(function(){t.setState({isVIPCallConfirmed:!0})})),It(Pt(t),"handleVIPCallNo",(function(){t._isSelectedUser=!1,t.setState({vip:null})})),It(Pt(t),"handleNameSubmit",(function(e){g.a.stop(),t.state.io.emit("SUBMIT_NAME",e),t.setState({isNameSubmitted:!0})})),It(Pt(t),"handleNameCancel",(function(){t._isShowNameForm=!1,t._isSelectedUser=!1,g.a.reset(),t.setState({isVIPCallConfirmed:!1,isNameSubmitted:!1,vip:null,queue:null})})),It(Pt(t),"handlePaySubmit",(function(e){t._isSelectedUser=!1,t.setState({stripeToken:e.success})})),It(Pt(t),"handlePayCancel",(function(){t._isSelectedUser=!1,g.a.reset(),t.setState({isVIPCallConfirmed:!1,isNameSubmitted:!1,vip:null,checkoutDetails:null,stripeToken:null})})),It(Pt(t),"handleQueueExit",(function(e){var n=t.state.io;e.preventDefault(),g.a.reset(),t.setState({isVIPCallConfirmed:!1,isNameSubmitted:!1,vip:null,checkoutDetails:null,stripeToken:null,queue:null}),y.a.update(!1),n.emit("LEAVE_QUEUE"),n.emit("LOAD_USERS")})),It(Pt(t),"handleVIPCallEnd",(function(e){t.tempVIP=t.state.vip,g.a.reset(),t.setState({isCallStarted:!1,isVIPCallConfirmed:!1,isNameSubmitted:!1,vip:null,checkoutDetails:null,stripeToken:null,queue:null,vipCallEndMessage:"Do you want another video greeting with ".concat(e.fullname,"?")})})),It(Pt(t),"handleVIPCallAgainYes",(function(){if(t.setState({vipCallEndMessage:null}),t.tempVIP){var e=t.tempVIP;t.tempVIP=null,t.handleUserSelect(e)}})),It(Pt(t),"handleVIPCallAgainNo",(function(){t.tempVIP=null,t.setState({vipCallEndMessage:null})})),It(Pt(t),"handleTermsAndPrivacyYes",(function(){t.setState({isTermsAndPrivacyAsked:!0})})),It(Pt(t),"handleTermsAndPrivacyNo",(function(){t.props.history.push("/")})),It(Pt(t),"handleGetUserMedia",(function(e,n){if(n)return console.log(n),void t.setState({isAskForUserMediaAccess:!1,isUserMediaAllowed:!1,stream:null});t.setState({isAskForUserMediaAccess:!1,isUserMediaAllowed:!0,stream:e})})),It(Pt(t),"handleFaceFind",(function(e){if(!e)return t.setState({isUserMediaAllowed:!1,avatar:"NO_AVATAR"}),console.log("no avatar");b.a.upload(e,t.state.userID).then((function(){return t.setState({avatar:e})})).then((function(){return t.openSocketConnection()})).catch((function(e){return console.log(e)}))})),It(Pt(t),"openSocketConnection",(function(){var e=t.state,n=e.userID,r=e.userIP,o=e.isUserMediaAllowed,a=d()(v.a.serverURL);a.once("connect",(function(){console.log("User ID:",n),console.log("User IP:",r),t.setState({io:a}),y.a.setIO(a);var e={userId:n,username:"guest",IP:r,userMediaAllowed:o,vip:!1,avatarId:o?n:null};a.emit("ADD_USER",e)})),a.once("connect_error",(function(e){console.log(e)})),a.once("disconnect",(function(e){a.emit("LEAVE_QUEUE"),t.props.history.push("/")})),a.once("ADDED",(function(){g.a.onTimeout=function(){window.location.href="/"},g.a.reset(),a.emit("LOAD_USERS")})),a.on("NAME_SUBMITTED",gt(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.get("".concat(v.a.serverURL,"/s/stripe/checkout_details"),{params:{vip_id:t.state.vip.userId}}).then((function(e){t.setState({checkoutDetails:e.data})})).catch((function(e){return console.log(e)}));case 2:case"end":return e.stop()}}),e)})))),a.on("QUEUE_JOINED",(function(e){g.a.stop();var n=e.map((function(e){return{userId:e.userId,username:e.username}}));t.setState({queue:n})})),a.on("QUEUE_LEFT",(function(e,n){if(n.isVip)t.setState({isVIPCallConfirmed:!1,isNameSubmitted:!1,vip:null,checkoutDetails:null,stripeToken:null,queue:null,vipLeftMessage:"Sorry, but ".concat(n.fullname," (@").concat(n.username,") has discontinued doing video calls \n                        at this moment. No payment has been taken from your card on this occasion.")});else{var r=null;e.length>0&&(r=e.map((function(e){return{userId:e.userId,username:e.username}}))),t.setState({queue:r})}})),a.on("USERS_LOADED",t.checkVIPCallRedirect),a.on("REQUEST_SENT",(function(){t._isSelectedUser=!1}))})),It(Pt(t),"checkVIPCallRedirect",(function(e){var n=t.state.io;if(e.length>0){n.off("USERS_LOADED",t.checkVIPCallRedirect);var r=h.a.parse(t.props.location.search).call_vip;if(r){var o=e.find((function(e){return e.userId===r}));o&&t.handleUserSelect(o)}}})),t.state={windowWidth:0,windowHeight:0,isTermsAndPrivacyAsked:!1,isUserMediaAllowed:!1,isAskForUserMediaAccess:!1,isCallStarted:!1,isVIPCallConfirmed:!1,isNameSubmitted:!1,userID:null,username:"guest",userIP:null,avatar:null,io:null,stream:null,vip:null,checkoutDetails:null,stripeToken:null,queue:null,vipLeftMessage:null,vipCallEndMessage:null,message:null},t.handleConnectionChange=t.handleConnectionChange.bind(Pt(t)),t.tempVIP=null,t._isMounted=!1,t._isShowNameForm=!1,t._isSelectedUser=!1,t}return t=u,(n=[{key:"componentDidMount",value:function(){this._isMounted=!0,window.addEventListener("resize",this.handleWindowResize),window.addEventListener("blur",this.handleWindowBlur),this.checkLogInStatus(),window.addEventListener("offline",this.handleConnectionChange),this.browserAndroidDetectHandler()}},{key:"componentDidUpdate",value:function(){var e=this.state,t=e.isTermsAndPrivacyExpired,n=e.isUserMediaAllowed,r=e.isAskForUserMediaAccess,o=e.io;!1===t&&!1===r&&!1===n&&null===o&&this.openSocketConnection()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,g.a.onTimeout=null,g.a.stop();var e=this.state.io;null!==e&&(e.off("NAME_SUBMITTED"),e.off("QUEUE_JOINED"),e.off("QUEUE_LEFT"),e.close()),window.removeEventListener("resize",this.handleWindowResize),window.removeEventListener("blur",this.handleWindowBlur)}},{key:"browserAndroidDetectHandler",value:function(){var e=o.a.createElement("h5",{className:"mb-0"},"Please use The Chat Matrix in the ",o.a.createElement("a",{href:"https://www.google.com/chrome/"},"Google Chrome")," web browser.");this.setState({message:e}),v.a.browserAndroidDetect&&this.setState({browserAndroidDetect:!0})}},{key:"handleConnectionChange",value:function(e){var t=this;"offline"===e.type&&setTimeout((function(){localStorage.setItem("connectChange","offline"),t.props.history.push("/")}),2e3)}},{key:"checkLogInStatus",value:(i=gt(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.get("".concat(v.a.serverURL,"/v/vip/user")).then((function(e){var n=e.data;"object"===vt(n)&&n.id&&n.accessToken?t.props.history.push("/vip"):t.initInitialStates()})).catch((function(e){console.log(e)}));case 2:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"initInitialStates",value:(a=gt(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.a.get("".concat(v.a.serverURL,"/c/client/ip")).then((function(e){t.setState({userID:f.a.uid(20),userIP:e.data,windowWidth:window.innerWidth,windowHeight:window.innerHeight})})).catch((function(e){return console.log(e)}));case 2:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"render",value:function(){var e=this,t=this.state,n=t.windowWidth,r=t.windowHeight,a=t.isTermsAndPrivacyAsked,i=t.isUserMediaAllowed,c=t.isCallStarted,s=t.isVIPCallConfirmed,u=t.isNameSubmitted,f=t.userID,p=t.userIP,d=t.avatar,m=t.io,h=t.stream,y=t.vip,v=t.checkoutDetails,b=t.stripeToken,g=t.queue,w=t.vipLeftMessage,E=t.vipCallEndMessage,S=t.browserAndroidDetect,C=t.message;this._isShowNameForm=null!==y&&s&&!1===u,this._isShowCheckoutForm=y&&s&&v&&(!b||!g);var P=null!==y&&!1===s;return o.a.createElement(l.a,{style:{overflow:"hidden"},fluid:!0},o.a.createElement(A.a,{onGetUserMedia:this.handleGetUserMedia}),!a&&i&&o.a.createElement(U,{onYes:this.handleTermsAndPrivacyYes,onNo:this.handleTermsAndPrivacyNo}),a&&o.a.createElement(T.a,{avatar:d,stream:h,isVIP:!1,onFind:this.handleFaceFind}),!1===c&&null===g&&o.a.createElement(Pe,{io:m,guestID:f,guestIP:p,windowWidth:n,windowHeight:r,onSelect:this.handleUserSelect}),null!==g&&o.a.createElement(Re,{userID:f,vip:y,stream:h,users:g,onExit:this.handleQueueExit}),o.a.createElement(_e.a,{isUserVIP:!1,userID:f,userIP:p,io:m,localStream:h,windowWidth:n,windowHeight:r,onAccept:this.handleCallAccept,onStart:this.handleCallStart,onExit:this.handleCallExit,onVIPEnd:this.handleVIPCallEnd}),P&&null===w&&o.a.createElement(Fe,{user:y,onYes:this.handleVIPCallYes,onNo:this.handleVIPCallNo}),this._isShowNameForm&&o.a.createElement(et,{user:y,onSubmit:this.handleNameSubmit,onCancel:this.handleNameCancel}),this._isShowCheckoutForm&&o.a.createElement(mt,{vip:y,userID:f,details:v,onSubmit:this.handlePaySubmit,onCancel:this.handlePayCancel}),null!==w&&o.a.createElement(ht.a,{message:w,resolveLabel:"Okay",onResolve:function(){return e.setState({vipLeftMessage:null})}}),null!==E&&o.a.createElement(ht.a,{message:E,resolveLabel:"Yes",rejectLabel:"No",onResolve:this.handleVIPCallAgainYes,onReject:this.handleVIPCallAgainNo}),S&&C&&o.a.createElement(yt.a,{message:C}))}}])&&wt(t.prototype,n),r&&wt(t,r),u}(r.Component);kt.propTypes={history:i.a.object,location:i.a.object};t.default=kt}}]);